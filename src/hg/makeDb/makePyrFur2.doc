#!/bin/csh -f # set emacs mode
exit; # don't actually run this like a script :)
 
# This file describes building the browser database for the archaeal
# species Pyrococcus furiosus

# DOWNLOAD SEQUENCE FROM GENBANK (DONE 02/10/04)

    ssh eieo
    mkdir /cluster/store5/archae/pyrFur2
    ln -s /cluster/store5/archae/pyrFur2 /cluster/data/pyrFur2
    cd /cluster/data/pyrFur2
    wget ftp://ftp.ncbi.nih.gov/genomes/Bacteria/Pyrococcus_furiosus/NC_003413.fna
    mv NC_003413.fna chr1.fa
     # Edit header of chr1.fa to '> pyrAer1'

# CREATE DATABASES AND A BUNCH OF INITIAL STUFF (DONE 02/10/04)

    ssh hgwdev
    echo 'create database pyrFur2' | hgsql ''
    cd /cluster/data/pyrFur2
    hgNibSeq pyrFur2 /cluster/data/pyrFur2/nib chr1.fa
    faSize -detailed chr1.fa > chrom.sizes
    mkdir -p /gbdb/pyrFur2/nib
    echo "create table grp (PRIMARY KEY(NAME)) select * from hg16.grp" \
	    | hgsql pyrFur2
    echo 'INSERT INTO dbDb \
        (name, description, nibPath, organism, \
                defaultPos, active, orderKey, genome, scientificName, \
                htmlPath, hgNearOk) values \
        ("pyrFur2", "Pyrococcus furiosus", "/gbdb/pyrFur2/nib", "P. furiosus", \
               "chr1:500000-550000", 1, 85, "Archae", \
                "Pyrococcus furiosus", "/gbdb/pyrFur2/html/description.html", \
                0);' \
      | hgsql -h genome-testdb hgcentraltest

    cd ~/kent/src/hg/makeDb/trackDb
    # edit the trackDb makefile

    # add the trackDb directories
    mkdir -p archae/pyrFur2
    cvs add archae
    cvs add archae/pyrFur2
    cvs commit

# GC PERCENT TRACK (DONE 02/10/04)

    ssh hgwdev
    mkdir -p /cluster/data/pyrFur2/bed/gcPercent
    cd /cluster/data/pyrFur2/bed/gcPercent
    hgsql pyrFur2 < ~/kent/src/hg/lib/gcPercent.sql
    hgGcPercent -win=2000 pyrFur2 ../../nib
    # edit ~/kent/src/hg/makeDb/trackDb/archae/trackDb.ra and add an entry for
    # GC percent for 2,000 base windows instead (simply cut and paste
    # ~/kent/src/hg/makeDb/trackDb/trackDb.ra).

# GC 20 BASE WIGGLE TRACK (DONE 8/25)

    mkdir /cluster/data/pyrFur2/bed/gc20Base
    cd /cluster/data/pyrFur2/bed/gc20Base
    mkdir wigData20 dataLimits20
    hgGcPercent -chr=chr1 -file=stdout -win=20 pyrFur2 ../../nib | grep -w GC | \
    awk '
{
    bases = $3 - $2
    perCent = $5/10.0
    printf "%d\t%.1f\n", $2+1, perCent
}' | wigAsciiToBinary -dataSpan=20 -chrom=chr1 \
	-wibFile=wigData20/gc20Base_1 -name=1 stdin > dataLimits20/chr1
    hgLoadWiggle pyrFur2 gc20Base wigData20/*.wig
    mkdir /gbdb/pyrFur2/wib
    ln -s `pwd`/wigData20/*.wib /gbdb/pyrFur2/wib

# GENBANK PROTEIN-CODING GENES (DONE 01/14/04)

    ssh hgwdev
    mkdir /cluster/data/pyrFur2/genbank
    cd /cluster/data/pyrFur2/genbank
    wget ftp://ftp.ncbi.nlm.nih.gov/genomes/Bacteria/Pyrococcus_furiosus/NC_003413.gbk
    mv NC_003413.gbk pyrFur2.gbk
    # Create 3 files to assist parsing of the genbank
    # 1. for a bed file
    echo 'chr1
start
end
locus_tag
1000
strand' > pyrFur2-params-bed.txt
    # 2. for the peptide parts
    echo 'locus_tag
translation' > pyrFur2-params-pep.txt
    # 3. for the other gene information
    echo 'locus_tag
product
note' > pyrFur2-params-xra.txt
    # Now extract the genes and information:
    gbArchaeGenome pyrFur2.gbk pyrFur2-params-bed.txt pyrFur2-genbank-cds.bed
    gbArchaeGenome pyrFur2.gbk pyrFur2-params-pep.txt pyrFur2-genbank-cds.pep
    gbArchaeGenome pyrFur2.gbk pyrFur2-params-xra.txt pyrFur2-genbank-cds.xra
    hgLoadBed pyrFur2 gbProtCode pyrFur2-genbank-cds.bed
    hgsql pyrFur2 < ~/kent/src/hg/lib/pepPred.sql
    hgsql pyrFur2 < ~/kent/src/hg/lib/minGeneInfo.sql
    echo rename table pepPred to gbProtCodePep | hgsql pyrFur2
    echo rename table minGeneInfo to gbProtCodeXra | hgsql pyrFur2
    echo load data local infile \'pyrFur2-genbank-cds.pep\' into table gbProtCodePep | hgsql pyrFur2
    echo load data local infile \'pyrFur2-genbank-cds.xra\' into table gbProtCodeXra | hgsql pyrFur2

# TIGR GENES (DONE 02/10/04)
    # First go to http://www.tigr.org/tigr-scripts/CMR2/gene_attribute_form.dbi
    # and fill out the web form as follows:
    #   - Pick "Retrieve attributes for the specified DNA feature within a specific 
    #     organism and/or a specific role category".
    #       * Pick "Pyrobaculum aerophilum IM2", and "Primary and TIGR annotation ORFs" 
    #         from the 1st and 3rd box.
    #       * Select everything from "Choose TIGR Annotation Gene Attributes"
    #       * Select "Primary Locus Name" from "Choose Primary Annotation Gene Attributes"
    #       * Select everything from "Choose Other Gene Attributes"
    #   - Click submit, and click save as tab-delimited file.
    ssh hgwdev
    mkdir /cluster/data/pyrFur2/bed/tigrCmrORFs
    cp pyrFur2-tigr.tab /cluster/data/pyrFur2/bed/tigrCmrORFs
    cd /cluster/data/pyrFur2/bed/tigrCmrORFs
    tigrCmrToBed pyrFur2-tigr.tab pyrFur2-tigr.bed
    hgLoadBed -tab pyrFur2 tigrCmrGene pyrFur2-tigr.bed -sqlTable=~/kent/src/hg/lib/tigrCmrGene.sql
    echo RENAME TABLE tigrCmrGene to tigrCmrORFs | hgsql pyrFur2

# Lowe Lab Microarrays (DONE 02/10/04)
    ssh hgwdev
    mkdir /cluster/data/pyrFur2/bed/llaPfuPrintA
    cp Pfu-arrays.{bed,exps} /cluster/data/pyrFur2/bed/llaPfuPrintA
    cd /cluster/data/pyrFur2/bed/llaPfuPrintA
    hgLoadBed pyrFur2 llaPfuPrintA Pfu-arrays.bed
    hgsql pyrFur2 < ~/kent/src/hg/lib/expRecord.sql
    echo RENAME TABLE expRecord to llaPfuPrintAExps | hgsql pyrFur2
    echo LOAD DATA LOCAL INFILE \'Pfu-arrays.exps\' INTO TABLE llaPfuPrintAExps | hgsql pyrFur2
    # for now I'm using both hgFixed and the pyrFur2 database for this... that will change.
    hgsql hgFixed < ~/kent/src/hg/lib/expRecord.sql
    echo RENAME TABLE expRecord to llaPfuPrintAExps | hgsql hgFixed
    echo LOAD DATA LOCAL INFILE \'Pfu-arrays.exps\' INTO TABLE llaPfuPrintAExps | hgsql hgFixed


