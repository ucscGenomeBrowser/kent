#!/bin/bash -e
#
# build-genbank
#
# Script that runs that download, processing, and alignment of GenBank and
# RefSeq.  This is run by cron daily.  It will run genbank-align to do
# alignment part.  That script should be edited add new genomes and assemblies.
# and run by hand if alignment needs to be manually finished.

# errors terminate with message
set -e
trap "echo Error: build-genbank failed on `hostname` >&2; exit 1" ERR
exec </dev/null

# allow 250mb core dumps
ulimit -c 256000

# initialize
gbRoot=/cluster/data/genbank
cd $gbRoot
. $gbRoot/lib/gbCommon.sh

# download and process
cd $gbRoot
nice gbDownloadStep
nice gbProcessStep -mkOrganismList

# FIXME: -keep is for parasol testing, remove soon
nice etc/align-genbank -keep

echo "`hostname` genbank build completed"
